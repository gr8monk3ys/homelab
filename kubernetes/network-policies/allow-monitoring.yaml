---
# Allow Prometheus Monitoring
# Enables Prometheus to scrape metrics from pods
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-prometheus-scraping
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  ingress:
  # Allow from Prometheus in monitoring namespace
  - from:
    - namespaceSelector:
        matchLabels:
          kubernetes.io/metadata.name: monitoring
      podSelector:
        matchLabels:
          app.kubernetes.io/name: prometheus
    ports:
    # Common metrics ports
    - protocol: TCP
      port: 9090  # Prometheus
    - protocol: TCP
      port: 9100  # Node exporter
    - protocol: TCP
      port: 9113  # Nginx exporter
    - protocol: TCP
      port: 9114  # Elasticsearch exporter
    - protocol: TCP
      port: 9187  # Postgres exporter
    - protocol: TCP
      port: 8080  # Various apps
    - protocol: TCP
      port: 3000  # Various apps
